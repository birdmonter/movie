<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Flex Sender</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #00b900; }
        textarea { width: 100%; height: 300px; border-radius: 8px; border: 1px solid #ddd; padding: 10px; font-family: monospace; font-size: 14px; box-sizing: border-box; }
        .btn-group { margin-top: 15px; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s; margin-bottom: 10px; }
        .btn-send { background-color: #00b900; color: white; }
        .btn-send:hover { background-color: #009e00; }
        .btn-logout { background-color: #ff4b4b; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2>Flex Message Sender</h2>
    <p>‡∏ß‡∏≤‡∏á JSON ‡∏à‡∏≤‡∏Å Flex Message Simulator ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:</p>
    
    <textarea id="flexJson" placeholder='{ "type": "bubble", "body": { ... } }'></textarea>

    <div class="btn-group">
        <button class="btn-send" onclick="sendFlex()">üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Send Message)</button>
        <button class="btn-logout" onclick="liff.logout(); location.reload();">Log Out</button>
    </div>
</div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
    async function main() {
        try {
            // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            await liff.init({ liffId: "1654802091-R75QobAB" });

            if (!liff.isLoggedIn()) {
                liff.login();
            }
        } catch (err) {
            console.error("LIFF Init Error:", err);
        }
    }

    async function sendFlex() {
        const jsonField = document.getElementById('flexJson').value;
        
        if (!jsonField) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á JSON ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            return;
        }

        try {
            const flexContent = JSON.parse(jsonField);
            
            await liff.sendMessages([
                {
                    type: "flex",
                    altText: "‡∏™‡πà‡∏á Flex Message ‡∏ú‡πà‡∏≤‡∏ô LIFF",
                    contents: flexContent
                }
            ]);

            alert("‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!");
            liff.closeWindow();
        } catch (error) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
            console.error(error);
        }
    }

    main();
</script>

</body>
</html>
