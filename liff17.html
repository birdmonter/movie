<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Flex Image Sender Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        :root {
            --primary-color: #06C755; /* LINE Green */
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
        }

        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; }

        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: var(--bg-gradient);
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        h2 { color: #333; text-align: center; margin-bottom: 25px; font-weight: 500; }

        .form-group { margin-bottom: 18px; }

        label { display: block; margin-bottom: 8px; color: #555; font-size: 0.9rem; }

        input[type=text], select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            outline: none;
        }

        input[type=text]:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(6, 199, 85, 0.1);
        }

        .btn-stack { display: flex; flex-direction: column; gap: 12px; margin-top: 25px; }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-save { background-color: #333; color: white; }
        .btn-share { background-color: var(--primary-color); color: white; }
        .btn-oa { background-color: #007bff; color: white; }
        .btn-tel { background-color: #ff4757; color: white; }

        button:active { transform: scale(0.98); opacity: 0.9; }
        
        .preview-text {
            font-size: 12px;
            color: #888;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Flex Image Sender</h2>

    <div class="form-group">
        <label>URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Direct Link)</label>
        <input type="text" id="linkImg" placeholder="https://example.com/image.jpg">
    </div>

    <div class="form-group">
        <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏£‡∏π‡∏õ</label>
        <input type="text" id="linkTo" placeholder="https://line.me/...">
    </div>

    <div class="form-group">
        <label>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏≤‡∏û (Aspect Ratio)</label>
        <select id="lsize">
            <option value="1:1">1:1 (Square)</option>
            <option value="1:1.5" selected>1:1.5 (Portrait)</option>
            <option value="4:5">4:5</option>
            <option value="16:9">16:9 (Wide)</option>
            <option value="2:1">2:1</option>
        </select>
    </div>

    <div class="btn-stack">
        <button class="btn-save" onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="btn-share" onclick="shareTargetPicker()">üì§ ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°</button>
        <button class="btn-oa" onclick="sendMessageOA()">üí¨ ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ (OA)</button>
        <button class="btn-tel" onclick="sendSticker()">‚≠ê ‡∏™‡πà‡∏á‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
    </div>
    
    <p class="preview-text" id="statusTxt">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF...</p>
</div>

<script>
    let config = {
        img: "",
        url: "",
        size: "1:1.5"
    };

    // --- 1. Initial LIFF ---
    async function main() {
        try {
            await liff.init({ liffId: "1654802091-0yd1nOzG" });
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                document.getElementById('statusTxt').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('refer')) sendSticker();
            }
        } catch (err) {
            console.error("LIFF Init Error", err);
        }
    }

    // --- 2. Save Data ---
    function saveData() {
        config.img = document.getElementById("linkImg").value.trim();
        config.url = document.getElementById("linkTo").value.trim();
        config.size = document.getElementById("lsize").value;

        if (!config.img || !config.url) {
            Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
            return;
        }

        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!', 'success');
    }

    // --- 3. Flex Message Template (‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô Flex ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö) ---
    function getFlexPayload() {
        return [{
            "type": "flex",
            "altText": "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà",
            "contents": {
                "type": "bubble",
                "size": "giga",
                "body": {
                    "type": "box",
                    "layout": "vertical",
                    "paddingAll": "0px", // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö
                    "contents": [{
                        "type": "image",
                        "url": config.img,
                        "size": "full",
                        "aspectMode": "cover",
                        "aspectRatio": config.size,
                        "action": {
                            "type": "uri",
                            "label": "‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå",
                            "uri": config.url
                        }
                    }]
                }
            }
        }];
    }

    // --- 4. Share Target Picker ---
    async function shareTargetPicker() {
        if (!config.img) return Swal.fire('‡∏•‡∏∑‡∏°‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'info');

        try {
            const res = await liff.shareTargetPicker(getFlexPayload());
            if (res) {
                Swal.fire({ title: '‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', icon: 'success', timer: 1500, showConfirmButton: false })
                    .then(() => liff.closeWindow());
            }
        } catch (err) {
            Swal.fire('Error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á', 'error');
        }
    }

    // --- 5. Send Message (OA) ---
    async function sendMessageOA() {
        if (!config.img) return Swal.fire('‡∏•‡∏∑‡∏°‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'info');

        try {
            await liff.sendMessages(getFlexPayload());
            Swal.fire({ title: '‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡πÅ‡∏•‡πâ‡∏ß!', icon: 'success', timer: 1500, showConfirmButton: false })
                .then(() => liff.closeWindow());
        } catch (err) {
            Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)', 'error');
        }
    }

    // --- 6. Send Sticker ---
    async function sendSticker() {
        try {
            await liff.sendMessages([{ "type": "sticker", "packageId": "11537", "stickerId": "52002734" }]);
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        } catch (err) {
            console.error(err);
        }
    }

    main();
</script>

</body>
</html>
