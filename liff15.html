<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Repair Reporting System</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        :root {
            --primary-color: #E63946; /* Red for Urgent/Repair */
            --secondary-color: #1D3557;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; }

        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: var(--bg-gradient);
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        h2 { color: var(--secondary-color); text-align: center; margin-bottom: 20px; }

        .form-group { margin-bottom: 15px; }

        label { display: block; margin-bottom: 5px; color: #444; font-size: 0.95rem; font-weight: 500; }

        input[type=text], select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
        }

        input:focus { border-color: var(--primary-color); }

        .btn-stack { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s;
        }

        .btn-save { background-color: var(--secondary-color); color: white; }
        .btn-share { background-color: #06C755; color: white; }
        
        button:active { transform: scale(0.98); }
        
        .status-txt {
            font-size: 12px;
            color: #777;
            text-align: center;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</h2>

    <div class="form-group">
        <label>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (Machine ID)</label>
        <input type="text" id="machineId" placeholder="‡πÄ‡∏ä‡πà‡∏ô HFT-031">
    </div>

    <div class="form-group">
        <label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö (Problem)</label>
        <input type="text" id="problem" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏£‡πâ‡∏≠‡∏ô, ‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á">
    </div>

    <div class="form-group">
        <label>URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</label>
        <input type="text" id="linkImg" placeholder="https://example.com/image.jpg">
    </div>

    <div class="form-group">
        <label>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
        <select id="lsize">
            <option value="1:1">1:1 (‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏ï‡∏∏‡∏£‡∏±‡∏™)</option>
            <option value="1:1.5" selected>1:1.5 (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)</option>
            <option value="16:9">16:9 (‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)</option>
        </select>
    </div>

    <div class="btn-stack">
        <button class="btn-save" onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="btn-share" onclick="shareTargetPicker()">üì§ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</button>
    </div>
    
    <p class="status-txt" id="statusTxt">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF...</p>
</div>

<script>
    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
    let config = {
        machine: "",
        problem: "",
        img: "",
        size: "1:1.5"
    };

    // 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF
    async function main() {
        try {
            await liff.init({ liffId: "1654802091-0yd1nOzG" }); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ID ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                document.getElementById('statusTxt').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÅ‡∏•‡πâ‡∏ß";
            }
        } catch (err) {
            console.error("LIFF Error", err);
        }
    }

    // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Input ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
    function saveData() {
        config.machine = document.getElementById("machineId").value.trim();
        config.problem = document.getElementById("problem").value.trim();
        config.img = document.getElementById("linkImg").value.trim();
        config.size = document.getElementById("lsize").value;

        if (!config.machine || !config.problem || !config.img) {
            Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
            return;
        }

        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'success');
    }

    // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message Dynamic
    function getFlexPayload() {
        return [{
            "type": "flex",
            "altText": "‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°: " + config.machine,
            "contents": {
                "type": "bubble",
                "size": "giga",
                "header": {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                        {
                            "type": "text",
                            "text": "üõ†Ô∏è ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà",
                            "weight": "bold",
                            "color": "#FFFFFF",
                            "size": "lg"
                        }
                    ],
                    "backgroundColor": "#E63946"
                },
                "hero": {
                    "type": "image",
                    "url": config.img,
                    "size": "full",
                    "aspectMode": "cover",
                    "aspectRatio": config.size
                },
                "body": {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                        {
                            "type": "text",
                            "text": "Machine ID: " + config.machine,
                            "weight": "bold",
                            "size": "xl",
                            "margin": "md"
                        },
                        {
                            "type": "separator",
                            "margin": "md"
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "margin": "lg",
                            "spacing": "sm",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "baseline",
                                    "spacing": "sm",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:",
                                            "color": "#aaaaaa",
                                            "size": "sm",
                                            "flex": 1
                                        },
                                        {
                                            "type": "text",
                                            "text": config.problem,
                                            "wrap": true,
                                            "color": "#666666",
                                            "size": "sm",
                                            "flex": 4
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "footer": {
                    "type": "box",
                    "layout": "vertical",
                    "spacing": "sm",
                    "contents": [
                        {
                            "type": "button",
                            "style": "primary",
                            "height": "sm",
                            "action": {
                                "type": "postback",
                                "label": "‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (Accept)",
                                "data": "action=accept&id=" + config.machine,
                                "displayText": "‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° " + config.machine
                            },
                            "color": "#1D3557"
                        }
                    ]
                }
            }
        }];
    }

    // 4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°
    async function shareTargetPicker() {
        if (!config.machine) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'info');

        try {
            const res = await liff.shareTargetPicker(getFlexPayload());
            if (res) {
                Swal.fire({ title: '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', icon: 'success', timer: 1500, showConfirmButton: false })
                    .then(() => liff.closeWindow());
            }
        } catch (err) {
            Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
        }
    }

    main();
</script>

</body>
</html>
