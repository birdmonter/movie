<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Maintenance Report (URL)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        :root {
            --primary-color: #E63946;
            --navy-color: #1D3557;
            --bg-gradient: linear-gradient(135deg, #1D3557 0%, #457B9D 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
        }

        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; }

        body {
            margin: 0; padding: 20px; min-height: 100vh;
            background: var(--bg-gradient);
            display: flex; justify-content: center; align-items: flex-start;
        }

        .container {
            width: 100%; max-width: 450px;
            background: var(--glass-bg);
            padding: 30px; border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        h2 { color: var(--primary-color); text-align: center; margin-bottom: 5px; font-weight: 500; }
        p.subtitle { text-align: center; color: #666; margin-bottom: 25px; font-size: 0.9rem; }

        .form-group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; color: #333; font-size: 0.9rem; font-weight: 500; }

        input[type=text], textarea {
            width: 100%; padding: 12px 15px; border: 2px solid #eee;
            border-radius: 12px; font-size: 16px; transition: all 0.3s ease; outline: none;
        }

        input:focus, textarea:focus { border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(230, 57, 70, 0.1); }

        /* Image Preview Box */
        .img-preview {
            width: 100%; height: 200px; background: #eee; border-radius: 12px;
            margin-bottom: 15px; display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 2px solid #fff;
        }
        .img-preview img { width: 100%; height: 100%; object-fit: cover; }

        .btn-stack { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; }

        button {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            font-size: 16px; font-weight: 500; cursor: pointer;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        .btn-save { background-color: #333; color: white; }
        .btn-share { background-color: var(--primary-color); color: white; }
        .btn-close { background-color: #f1f1f1; color: #333; }

        button:active { transform: scale(0.98); opacity: 0.9; }
        
        #statusTxt { font-size: 11px; color: #888; text-align: center; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ShotBlast</h2>
    <p class="subtitle">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>

    <div class="img-preview" id="previewBox">
        <span id="placeholderTxt" style="color:#999">‡πÉ‡∏™‡πà URL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ</span>
    </div>

    <div class="form-group">
        <label>URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
        <input type="text" id="linkImg" placeholder="https://..." oninput="updatePreview()">
    </div>

    <div class="form-group">
        <label>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (Machine ID)</label>
        <input type="text" id="mID" value="HFT-031">
    </div>

    <div class="form-group">
        <label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
        <textarea id="issue" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢..."></textarea>
    </div>

    <div class="btn-stack">
        <button class="btn-save" onclick="saveData()">üíæ 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="btn-share" onclick="shareReport()">üì§ 2. ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°</button>
        <button class="btn-close" onclick="liff.closeWindow()">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
    </div>
    
    <p id="statusTxt">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î LIFF...</p>
</div>

<script>
    let reportData = {
        img: "",
        mID: "",
        issue: ""
    };

    async function main() {
        try {
            await liff.init({ liffId: "1654802091-0yd1nOzG" });
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                document.getElementById('statusTxt').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            }
        } catch (err) { console.error(err); }
    }

    function updatePreview() {
        const url = document.getElementById('linkImg').value.trim();
        const box = document.getElementById('previewBox');
        if(url) {
            box.innerHTML = `<img src="${url}" onerror="this.src='https://via.placeholder.com/400x250?text=Invalid+Image+URL'">`;
        } else {
            box.innerHTML = `<span style="color:#999">‡πÉ‡∏™‡πà URL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ</span>`;
        }
    }

    function saveData() {
        reportData.img = document.getElementById("linkImg").value.trim();
        reportData.mID = document.getElementById("mID").value.trim();
        reportData.issue = document.getElementById("issue").value.trim();

        if (!reportData.img || !reportData.issue) {
            Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢', 'warning');
            return;
        }
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏î‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!', 'success');
    }

    function getFlexPayload() {
        return [{
            "type": "flex",
            "altText": "üõ†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á " + reportData.mID,
            "contents": {
                "type": "bubble",
                "size": "giga",
                "header": {
                    "type": "box", "layout": "vertical",
                    "contents": [{ "type": "text", "text": "üõ†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏áShotBlast", "weight": "bold", "color": "#FFFFFF", "size": "lg" }],
                    "backgroundColor": "#E63946"
                },
                "hero": {
                    "type": "image", "url": reportData.img, "size": "full", "aspectMode": "cover", "aspectRatio": "20:13"
                },
                "body": {
                    "type": "box", "layout": "vertical",
                    "contents": [
                        { "type": "text", "text": "Machine ID: " + reportData.mID, "weight": "bold", "size": "xl", "margin": "md" },
                        { "type": "separator", "margin": "md" },
                        {
                            "type": "box", "layout": "vertical", "margin": "lg", "spacing": "sm",
                            "contents": [{
                                "type": "box", "layout": "baseline", "spacing": "sm",
                                "contents": [
                                    { "type": "text", "text": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:", "color": "#aaaaaa", "size": "sm", "flex": 1 },
                                    { "type": "text", "text": reportData.issue, "wrap": true, "color": "#666666", "size": "sm", "flex": 4 }
                                ]
                            }]
                        }
                    ]
                },
                "footer": {
                    "type": "box", "layout": "vertical", "spacing": "sm",
                    "contents": [{
                        "type": "button", "style": "primary", "height": "sm",
                        "action": {
                            "type": "postback", "label": "‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (Accept)",
                            "data": "action=accept&id=" + reportData.mID,
                            "displayText": "‡∏ï‡∏Å‡∏•‡∏á ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á " + reportData.mID + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö üëå"
                        },
                        "color": "#1D3557"
                    }]
                }
            }
        }];
    }

    async function shareReport() {
        if (!reportData.img) return Swal.fire('‡∏•‡∏∑‡∏°‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'info');
        try {
            const res = await liff.shareTargetPicker(getFlexPayload());
            if (res) liff.closeWindow();
        } catch (err) { Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ', 'error'); }
    }

    main();
</script>
</body>
</html>
