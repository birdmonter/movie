<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Repair Reporting System</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --primary-color: #E63946; --secondary-color: #1D3557; }
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; }
        body { margin: 0; padding: 20px; background: #f5f7fa; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 450px; background: white; padding: 25px; border-radius: 20px; shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
        button { width: 100%; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; margin-top: 10px; color: white; }
        .btn-share { background-color: #06C755; }
        .btn-oa { background-color: #007bff; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>

    <div class="form-group">
        <label>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (Machine ID)</label>
        <input type="text" id="machineId" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: HFT-031">
    </div>

    <div class="form-group">
        <label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
        <input type="text" id="problem" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢">
    </div>

    <div class="form-group">
        <label>URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
        <input type="text" id="linkImg" placeholder="https://...">
    </div>

    <div class="form-group">
        <label>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏≤‡∏û</label>
        <select id="lsize">
            <option value="1:1">1:1</option>
            <option value="1:1.5" selected>1:1.5</option>
            <option value="16:9">16:9</option>
        </select>
    </div>

    <button class="btn-share" onclick="handleSend('share')">üì§ ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°</button>
    <button class="btn-oa" onclick="handleSend('oa')">üí¨ ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ (OA)</button>
    
    <p id="statusTxt" style="text-align:center; font-size:12px; color:gray;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î LIFF...</p>
</div>

<script>
    async function main() {
        try {
            await liff.init({ liffId: "1654802091-0yd1nOzG" });
            if (!liff.isLoggedIn()) { liff.login(); }
            document.getElementById('statusTxt').innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        } catch (err) { console.error(err); }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Input
    function getFormData() {
        return {
            machine: document.getElementById("machineId").value.trim(),
            problem: document.getElementById("problem").value.trim(),
            img: document.getElementById("linkImg").value.trim() || "https://scdn.line-apps.com/n/channel_devcenter/img/fx/01_1_cafe.png",
            size: document.getElementById("lsize").value
        };
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Payload ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    function createPayload(data) {
        return [{
            "type": "flex",
            "altText": "‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á " + data.machine,
            "contents": {
                "type": "bubble",
                "header": { "type": "box", "layout": "vertical", "contents": [{ "type": "text", "text": "üõ†Ô∏è ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°", "weight": "bold", "color": "#FFFFFF" }], "backgroundColor": "#E63946" },
                "hero": { "type": "image", "url": data.img, "size": "full", "aspectRatio": data.size, "aspectMode": "cover" },
                "body": {
                    "type": "box", "layout": "vertical", "contents": [
                        { "type": "text", "text": "Machine ID: " + data.machine, "weight": "bold", "size": "xl" },
                        { "type": "separator", "margin": "md" },
                        { "type": "box", "layout": "baseline", "margin": "md", "contents": [
                            { "type": "text", "text": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:", "color": "#aaaaaa", "size": "sm", "flex": 1 },
                            { "type": "text", "text": data.problem, "wrap": true, "color": "#666666", "size": "sm", "flex": 4 }
                        ]}
                    ]
                },
                "footer": {
                    "type": "box", "layout": "vertical", "contents": [{
                        "type": "button", "style": "primary", "color": "#1D3557",
                        "action": { "type": "postback", "label": "‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (Accept)", "data": "action=accept&id=" + data.machine, "displayText": "‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô " + data.machine + " ‡πÅ‡∏•‡πâ‡∏ß" }
                    }]
                }
            }
        }];
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    async function handleSend(type) {
        const data = getFormData();
        if (!data.machine || !data.problem) {
            return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£', 'warning');
        }

        const payload = createPayload(data);

        try {
            let res;
            if (type === 'share') {
                res = await liff.shareTargetPicker(payload);
            } else {
                res = await liff.sendMessages(payload);
            }

            if (res || type === 'oa') {
                Swal.fire({ icon: 'success', title: '‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500 });
            }
        } catch (err) {
            Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ: ' + err.message, 'error');
        }
    }

    main();
</script>

</body>
</html>
